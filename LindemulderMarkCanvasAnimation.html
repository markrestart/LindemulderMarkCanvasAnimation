<!doctype html>
<html lang="en">
<head>
 <title>Particle System</title>
 <meta charset="utf-8">
 <style>
 body {
    background-color: black;
}
canvas {
 border: 10px solid grey;
 display: block;
 margin-left: auto;
 margin-right: auto
}
</style>
 <script>
 var playerX = 550;
 var startX;
 var startY;
 var canvas;
 var context;
 var particles = [];
 var timer;
 var timerRestart;
 function makeParticles(x,y) {
	//create an array of particles for our animation
	for(var i = 0; i < 1; i++)
	{
		particles.push(new Particle(x,y));
	}
 }
 function degreesToRadians(degrees) {
	 //converts from degrees to radians and returns
	 return (degrees * Math.PI)/180;
 }
 function Particle(x,y)
 {
	 //the constructor for a single particle, with random starting x+y, velocity, color, and radius
	 this.x = startX;
	 this.y = startY;
	 this.vx = ((startX-x)*(-1))/10;
	 this.vy = ((startY-y)*(-1))/10;
	 var colors = ["darkred","crimson","maroon","red","red","red","orangered","darkorange","yellow"];
	 this.color = colors[Math.floor(Math.random()*colors.length)];
	 this.radius = 25;
	 this.shape = Math.floor(Math.random()*5);
 }
 
 function getStartPosition(event) {
	var x = event.x;
	var y = event.y;

	var canvas = document.getElementById("canvas");

	x -= canvas.offsetLeft;
	y -= canvas.offsetTop;

	startX = x;
	startY = y;

}

 function getEndPosition(event) {
	var x = event.x;
	var y = event.y;

	var canvas = document.getElementById("canvas");

	x -= canvas.offsetLeft;
	y -= canvas.offsetTop;
	
	makeParticles(x,y);
}
 
 function moveParticles() {
	 //partially clear the screen to fade previous circles, and draw a new particle at each new coordinate
	 context.font = "100px Arial";
	 
	 
	 context.globalCompositeOperation = "hard-light";
	 context.fillStyle = "rgba(0, 0, 0, 1)";
	 context.fillRect(0, 0, canvas.width, canvas.height);
	 context.globalCompositeOperation = "source-atop";
	 for(var i = 0; i < particles.length; i++)
	 {
		 var p = particles[i];
		 
			makeCircle(p.x, p.y, p.radius, p.color);
	 
			p.x += p.vx;
			p.y += p.vy;
		 
		 
		 //bounce
		if (p.x + p.vx > canvas.width || p.x + p.vx < 0)
		p.vx = -p.vx;

		if (p.y + p.vy > canvas.height-25 || p.y + p.vy < 0)
		p.vy = -p.vy;
		

		if (p.x + p.vx > playerX && p.x + p.vx < playerX && p.y + p.vy == canvas.height - 75) {
			p.vy = -p.vy;
			console.log("hit");
		}

		 //Air friction
		 if(p.vx > 0) p.vx = p.vx - .05;
		 if(p.vx < 0) p.vx = p.vx + .05;
		 if(p.vy > 0) p.vy = p.vy - .05;
		 if(p.vy < 0) p.vy = p.vy + .05;
		 
		 
		 
		 //gravity/floor Click
		 if(p.vy < 50) p.vy++;
		 if(p.y > canvas.height-25) {
			p.y=canvas.height-25;
			if(p.vx > 0) p.vx = p.vx - 1.5;
			if(p.vx < 0) p.vx = p.vx + 1.5;
}		 
		 //wrap around (shoudln't trigger)
		 if(p.x < -50) p.x = canvas.width+50;
		 if(p.y < -50) p.y = canvas.height+50;
		 if(p.x > canvas.width+50) p.x = -50;
		 if(p.y > canvas.height+50) p.y = -50;
		 
		 
		 if(p.radius < 1) particles.splice(i, 1);
	 }
	 makeShapeTwo(playerX, canvas.height-50, 100, 30, 'Blue');
	 
	if (keys.left) {
		playerX = PlayerX - 10;
    }
	if (keys.right) {
		playerX = PlayerX + 10;
    }
	 
 }
 
 function makeCircle(x, y, r, c) {
		context.beginPath();
		context.arc(x, y, r, 0, degreesToRadians(360), true);
		context.fillStyle = c;
		context.fill();
		console.log("circle");
 }
 
  function makeShapeTwo(x, y, r, r2, c) {
		context.beginPath();
		context.rect(x, y, r, r2);
		context.fillStyle = c;
		context.fill();
		console.log("square");
 }
 
 function trackKeys(codes) {
  var pressed = Object.create(null);

  // alters the current "pressed" array which is returned from this function. 
  // The "pressed" variable persists even after this function terminates
  // That is why we needed to assign it using "Object.create()" as 
  // otherwise it would be garbage collected

  function handler(event) {
    if (codes.hasOwnProperty(event.keyCode)) {
      // If the event is keydown, set down to true. Else set to false.
      var down = event.type == "keydown";
      pressed[codes[event.keyCode]] = down;
      // We don't want the key press to scroll the browser window, 
      // This stops the event from continuing to be processed
      event.preventDefault();
    }
  }
  addEventListener("keydown", handler);
  addEventListener("keyup", handler);
  return pressed;
}
 
 function clearScreen(color) {
	 //clears the screen and fills with the color of choice
	 context.clearRect(0, 0, canvas.width, canvas.height);
	 context.fillStyle = color;
	 context.fillRect(0, 0, canvas.width, canvas.height);
 }
 window.onload = function() {
 	 canvas = document.getElementById('canvas');
	 context = canvas.getContext('2d');
	 makeParticles();
	 timer = setInterval(moveParticles, 32);
	 canvas.addEventListener("mousedown", getStartPosition, false);
	 canvas.addEventListener("mouseup", getEndPosition, false);
 }
</script>
</head>
<body>
	<canvas id="canvas" width="1200" height="700"></canvas>
	Click, drag, and release to shoot fire.
</body>
</html>